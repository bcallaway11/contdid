<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Difference-in-Differences with a Continuous Treatment ‚Ä¢ contdid</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Difference-in-Differences with a Continuous Treatment">
<meta name="description" content="Difference-in-differences with a continuous treatment and staggered treatment adoption. The package supports estimation of treatment effects and causal responses as a function of the dose, event studies indexed by length of exposure to the treatment, and aggregations into overall average effects. It also includes uniform inference procedures and both parametric and nonparametric models for treatment effects. The methods are based on Callaway, Goodman-Bacon, and Sant'Anna (2025) &lt;doi:10.48550/arXiv.2107.02637&gt;.">
<meta property="og:description" content="Difference-in-differences with a continuous treatment and staggered treatment adoption. The package supports estimation of treatment effects and causal responses as a function of the dose, event studies indexed by length of exposure to the treatment, and aggregations into overall average effects. It also includes uniform inference procedures and both parametric and nonparametric models for treatment effects. The methods are based on Callaway, Goodman-Bacon, and Sant'Anna (2025) &lt;doi:10.48550/arXiv.2107.02637&gt;.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">contdid</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="https://github.com/bcallaway11/contdid"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="contdid">contdid<a class="anchor" aria-label="anchor" href="#contdid"></a>
</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<p>An R package for difference-in-differences with a continuous treatment.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of contdid from <a href="https://github.com/bcallaway11/contdid">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"bcallaway11/contdid"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bcallaway11.github.io/contdid/" class="external-link">contdid</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="package-status-alpha-version">Package Status: Alpha Version<a class="anchor" aria-label="anchor" href="#package-status-alpha-version"></a>
</h2>
<p>This is an <strong>alpha version</strong> of the <code>contdid</code> package. The core features are implemented and functional, but the package remains under active development. The API may change, and additional functionality is planned.</p>
<p>We welcome feedback and encourage users to report bugs or other issues via the <a href="https://github.com/bcallaway11/contdid/issues">GitHub Issues page</a>.</p>
<div class="section level3">
<h3 id="id_-currently-supported">‚úÖ Currently Supported<a class="anchor" aria-label="anchor" href="#id_-currently-supported"></a>
</h3>
<ul>
<li>‚òëÔ∏è Continuous treatments</li>
<li>‚òëÔ∏è Staggered treatment adoption (i.e., more than two periods and variation in timing across units)</li>
<li>‚òëÔ∏è Aggregations into dose-specific ATT‚Äôs or ACRT‚Äôs</li>
<li>‚òëÔ∏è Aggregations into ATT or ACRT versions of event studies</li>
<li>‚òëÔ∏è User-specified flexible parametric models for treatment effects as a function of the dose</li>
</ul>
</div>
<div class="section level3">
<h3 id="id_-not-yet-supported">üö´ Not Yet Supported<a class="anchor" aria-label="anchor" href="#id_-not-yet-supported"></a>
</h3>
<ul>
<li>
<p>‚ùå Discrete treatments</p>
<ul>
<li>This is straightforward and could be implemented by users directly, but we don‚Äôt have it in the package yet.</li>
</ul>
</li>
<li>
<p>‚ö†Ô∏è Data-driven models for treatment effects as a function of the dose</p>
<ul>
<li>We have this working for cases without staggered adoption, but it is not yet implemented for staggered adoption. We plan to add this in the future.</li>
</ul>
</li>
<li><p>‚ùå Repeated cross-sections data</p></li>
<li><p>‚ùå Unbalanced panel data</p></li>
<li>
<p>‚ùå Doses that vary over time</p>
<ul>
<li>Not sure if we will ever support this, or maybe only in limited contexts._</li>
</ul>
</li>
<li><p>‚ùå Including covariates</p></li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="conceptual-setup">Conceptual Setup<a class="anchor" aria-label="anchor" href="#conceptual-setup"></a>
</h2>
<p>Below, we give several examples of how to estimate causal effect parameters using the <code>contdid</code> package.</p>
<p>At a high level, the interface is basically the same as for the <code>did</code> package and for packages that rely on the <code>ptetools</code> backend, with only a few pieces of additional information being required. First, the name of the continuous treatment variable should be passed through the <code>dname</code> argument.</p>
<p>The <code>cont_did</code> function expects the continuous treatment variable to behave in certain ways:</p>
<ol style="list-style-type: decimal">
<li><p>It needs to be time-invariant.</p></li>
<li><p>It should be set to its time-invariant value in pre-treatment periods. This is just a convention of the package, but, in particular, you should not have the treatment variable coded as being 0 in pre-treatment periods.</p></li>
<li><p>For units that don‚Äôt participate in the treatment in any time period, the treatment variable just needs to be time-invariant. In some applications, e.g., the continuous treatment variable may be defined for units that don‚Äôt actually participate in the treatment. In other applications, it may not be defined for units that do not participate in the treatment. The function behaves the same way in either case.</p></li>
</ol>
<p>Next, the other important parameters are <code>target_parameter</code>, <code>aggregation</code>, and <code>treatment_type</code>:</p>
<ul>
<li><p><code>target_parameter</code> can either be ‚Äúlevel‚Äù or ‚Äúslope‚Äù. If ‚Äúlevel‚Äù, then the function will calculate <code>ATT</code> parameters. If set to be ‚Äúslope‚Äù, then the function will calculate <code>ACRT</code> parameters‚Äîthese are causal response parameters that are derivatives of the <code>ATT</code> parameters. Our paper <a href="https://arxiv.org/abs/2107.02637" class="external-link">Callaway, Goodman-Bacon, and Sant‚ÄôAnna (2024)</a> points out some complications for interpreting these derivative type parameters under the most commonly invoked version of the parallel trends assumption.</p></li>
<li><p><code>aggregation</code> can either by ‚Äúeventstudy‚Äù or ‚Äúdose‚Äù. For ‚Äúeventstudy‚Äù, depending on the value of the <code>target_parameter</code> argument, the function will provide either the average <code>ATT</code> across different event times or the average <code>ACRT</code> across different event times. For ‚Äúdose‚Äù, the function will average across all time periods and report average affects across different values of the continuous treatment. For the ‚Äúdose‚Äù aggregation, results are calculated for both <code>ATT</code> and <code>ACRT</code> and can be displayed by providing different arguments to plotting functions (see example below).</p></li>
<li><p><code>treatment_type</code> can either be ‚Äúcontinuous‚Äù or ‚Äúdiscrete‚Äù. Currently only ‚Äúcontinuous‚Äù is supported. In this case, the code proceeds as if the treatment really is continuous. The estimate are computed nonparametrically using B-splines. The user can control the number of knots and the degree of the B-splines using the <code>num_knots</code> and <code>degree</code> arguments. The defaults are <code>num_knots=0</code> and <code>degree=1</code> which amounts to estimating <code>ATT(d)</code> by estimating a linear model in the continuous treatment among treated units and subtracting the average outcome among the comparison units.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p>With a continuous treatment, the underlying building blocks are treatment effects that are local to a particular timing group <code>g</code> in a particular time period <code>t</code> that experienced a particular value of the treatment <code>d</code>. These treatment affects are relatively high-dimensional, and most applications are likely to involve aggregating/combining these underlying parameters. We focus on aggregations that (i) average across timing-groups and time periods to given average treatment effect parameters as a function of the dose <code>d</code> or (ii) averages across doses and partially across timing group and time periods in order to give event studies.</p>
<p>For the results below, we will simulate some data, where the continuous treatment <code>D</code> has no effect on the outcome.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/simulate_contdid_data.html">simulate_contdid_data</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>  num_time_periods <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  num_groups <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  dose_linear_effect <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  dose_quadratic_effect <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt;   id G          D time_period         Y</span></span>
<span><span class="co">#&gt; 1  1 2 0.08593221           1 0.3579583</span></span>
<span><span class="co">#&gt; 2  1 2 0.08593221           2 5.2354694</span></span>
<span><span class="co">#&gt; 3  1 2 0.08593221           3 3.2717079</span></span>
<span><span class="co">#&gt; 4  1 2 0.08593221           4 4.3988042</span></span>
<span><span class="co">#&gt; 5  2 4 0.17217781           1 5.9743351</span></span>
<span><span class="co">#&gt; 6  2 4 0.17217781           2 5.8463051</span></span></code></pre></div>
<div class="section level3">
<h3 id="case-1-dose-aggregation">Case 1: Dose Aggregation<a class="anchor" aria-label="anchor" href="#case-1-dose-aggregation"></a>
</h3>
<p>The following code can be used to estimate the <code>ATT(d)</code> and <code>ACRT(d)</code> parameters for the continuous treatment <code>D</code> using the <code>cont_did</code> function. The <code>aggregation</code> argument is set to ‚Äúdose‚Äù and the <code>target_parameter</code> argument is set to ‚Äúlevel‚Äù for <code>ATT(d)</code> and ‚Äúslope‚Äù for <code>ACRT(d)</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cd_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cont_did.html">cont_did</a></span><span class="op">(</span></span>
<span>  yname <span class="op">=</span> <span class="st">"Y"</span>,</span>
<span>  tname <span class="op">=</span> <span class="st">"time_period"</span>,</span>
<span>  idname <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>  dname <span class="op">=</span> <span class="st">"D"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">df</span>,</span>
<span>  gname <span class="op">=</span> <span class="st">"G"</span>,</span>
<span>  target_parameter <span class="op">=</span> <span class="st">"slope"</span>,</span>
<span>  aggregation <span class="op">=</span> <span class="st">"dose"</span>,</span>
<span>  treatment_type <span class="op">=</span> <span class="st">"continuous"</span>,</span>
<span>  control_group <span class="op">=</span> <span class="st">"notyettreated"</span>,</span>
<span>  biters <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  cband <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  num_knots <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  degree <span class="op">=</span> <span class="fl">3</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cd_res</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall ATT:  </span></span>
<span><span class="co">#&gt;      ATT    Std. Error     [ 95%  Conf. Int.] </span></span>
<span><span class="co">#&gt;  -0.0265        0.0301    -0.0855      0.0325 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall ACRT:  </span></span>
<span><span class="co">#&gt;    ACRT    Std. Error     [ 95%  Conf. Int.]  </span></span>
<span><span class="co">#&gt;  0.1341        0.0485      0.039      0.2293 *</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes: `*' confidence band does not cover 0</span></span>
<span><span class="fu"><a href="reference/ggcont_did.html">ggcont_did</a></span><span class="op">(</span><span class="va">cd_res</span>, type <span class="op">=</span> <span class="st">"att"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-5-1.png" width="100%"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/ggcont_did.html">ggcont_did</a></span><span class="op">(</span><span class="va">cd_res</span>, type <span class="op">=</span> <span class="st">"acrt"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-5-2.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="case-2-event-study-aggregations">Case 2: Event Study Aggregations<a class="anchor" aria-label="anchor" href="#case-2-event-study-aggregations"></a>
</h3>
<p>Next, we consider event study aggregations. The first is an event study aggregation for <code>ATT</code>. The second is an event study aggregation for <code>ACRT</code>.</p>
<p><strong>Event study aggregation for <code>ATT</code>:</strong></p>
<p>Notice that the target parameter is set <code>level</code> to target ATT, and the <code>aggregation</code> argument is set to <code>eventstudy</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cd_res_es_level</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cont_did.html">cont_did</a></span><span class="op">(</span></span>
<span>  yname <span class="op">=</span> <span class="st">"Y"</span>,</span>
<span>  tname <span class="op">=</span> <span class="st">"time_period"</span>,</span>
<span>  idname <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>  dname <span class="op">=</span> <span class="st">"D"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">df</span>,</span>
<span>  gname <span class="op">=</span> <span class="st">"G"</span>,</span>
<span>  target_parameter <span class="op">=</span> <span class="st">"level"</span>,</span>
<span>  aggregation <span class="op">=</span> <span class="st">"eventstudy"</span>,</span>
<span>  treatment_type <span class="op">=</span> <span class="st">"continuous"</span>,</span>
<span>  control_group <span class="op">=</span> <span class="st">"notyettreated"</span>,</span>
<span>  biters <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  cband <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  num_knots <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  degree <span class="op">=</span> <span class="fl">3</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cd_res_es_level</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall ATT:  </span></span>
<span><span class="co">#&gt;      ATT    Std. Error     [ 95%  Conf. Int.] </span></span>
<span><span class="co">#&gt;  -0.0243        0.0289    -0.0808      0.0323 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Dynamic Effects:</span></span>
<span><span class="co">#&gt;  Event Time Estimate Std. Error   [95%  Conf. Band] </span></span>
<span><span class="co">#&gt;          -2  -0.0222     0.0504 -0.1488      0.1044 </span></span>
<span><span class="co">#&gt;          -1   0.0116     0.0271 -0.0565      0.0798 </span></span>
<span><span class="co">#&gt;           0  -0.0039     0.0299 -0.0790      0.0713 </span></span>
<span><span class="co">#&gt;           1  -0.0160     0.0397 -0.1157      0.0837 </span></span>
<span><span class="co">#&gt;           2  -0.0839     0.0419 -0.1891      0.0212 </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes: `*' confidence band does not cover 0</span></span>
<span><span class="fu"><a href="reference/ggcont_did.html">ggcont_did</a></span><span class="op">(</span><span class="va">cd_res_es_level</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-6-1.png" width="100%"></p>
<p><strong>Event study aggregation for <code>ACRT</code>:</strong></p>
<p>Relative to the previous code, notice that the target parameter is set <code>slope</code> to target ACRT.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cd_res_es_slope</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cont_did.html">cont_did</a></span><span class="op">(</span></span>
<span>  yname <span class="op">=</span> <span class="st">"Y"</span>,</span>
<span>  tname <span class="op">=</span> <span class="st">"time_period"</span>,</span>
<span>  idname <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>  dname <span class="op">=</span> <span class="st">"D"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">df</span>,</span>
<span>  gname <span class="op">=</span> <span class="st">"G"</span>,</span>
<span>  target_parameter <span class="op">=</span> <span class="st">"slope"</span>,</span>
<span>  aggregation <span class="op">=</span> <span class="st">"eventstudy"</span>,</span>
<span>  treatment_type <span class="op">=</span> <span class="st">"continuous"</span>,</span>
<span>  control_group <span class="op">=</span> <span class="st">"notyettreated"</span>,</span>
<span>  biters <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  cband <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  num_knots <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  degree <span class="op">=</span> <span class="fl">3</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cd_res_es_slope</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall ACRT:  </span></span>
<span><span class="co">#&gt;     ATT    Std. Error     [ 95%  Conf. Int.]  </span></span>
<span><span class="co">#&gt;  0.1341        0.0584     0.0197      0.2485 *</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Dynamic Effects:</span></span>
<span><span class="co">#&gt;  Event Time Estimate Std. Error   [95%  Conf. Band]  </span></span>
<span><span class="co">#&gt;          -2  -0.0701     0.0808 -0.2710      0.1308  </span></span>
<span><span class="co">#&gt;          -1  -0.2212     0.0892 -0.4431      0.0007  </span></span>
<span><span class="co">#&gt;           0   0.1592     0.0586  0.0136      0.3048 *</span></span>
<span><span class="co">#&gt;           1   0.0551     0.0828 -0.1509      0.2610  </span></span>
<span><span class="co">#&gt;           2  -0.5405     0.1154 -0.8275     -0.2535 *</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes: `*' confidence band does not cover 0</span></span>
<span><span class="fu"><a href="reference/ggcont_did.html">ggcont_did</a></span><span class="op">(</span><span class="va">cd_res_es_slope</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-7-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="case-3-data-driven-nonparametric-model-for-treatment-effects">Case 3: Data-Driven Nonparametric Model for Treatment Effects<a class="anchor" aria-label="anchor" href="#case-3-data-driven-nonparametric-model-for-treatment-effects"></a>
</h3>
<p>In most applications, it is hard to know the correct functional form for the treatment effects as a function of the dose. In Callaway, Goodman-Bacon, and Sant‚ÄôAnna (2025), the approach we emphasize comes from Chen, Christensen, and Kankanala (2025), and the <code>contdid</code> package uses their <a href="https://github.com/JeffreyRacine/npiv" class="external-link"><code>npiv</code> package</a> to implement this approach. Code-wise, the only thing to change is to set the argument <code>dose_est_method="cck"</code>. [Note that we currently only support this option for the case with two periods and no staggered adoption. With more periods, you can average the pre- and post-treatment periods to reduce it to a two period case and then run the code below; in fact, this is what we did in the application in our paper.]</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># simulate data with only two periods</span></span>
<span><span class="co"># add quadratic effect to see how well we can detect it</span></span>
<span><span class="co"># (note code will not "know" that the effect is quadratic)</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/simulate_contdid_data.html">simulate_contdid_data</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>  num_time_periods <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  num_groups <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  dose_linear_effect <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  dose_quadratic_effect <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">df2</span><span class="op">$</span><span class="va">D</span><span class="op">[</span><span class="va">df2</span><span class="op">$</span><span class="va">G</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df2</span><span class="op">)</span></span>
<span><span class="co">#&gt;   id G        D time_period           Y</span></span>
<span><span class="co">#&gt; 1  1 2 0.890987           1  1.84272906</span></span>
<span><span class="co">#&gt; 2  1 2 0.890987           2  5.30890209</span></span>
<span><span class="co">#&gt; 3  2 0 0.000000           1  0.59423237</span></span>
<span><span class="co">#&gt; 4  2 0 0.000000           2  2.81443324</span></span>
<span><span class="co">#&gt; 5  3 0 0.000000           1  1.77438193</span></span>
<span><span class="co">#&gt; 6  3 0 0.000000           2 -0.01032246</span></span>
<span></span>
<span><span class="va">cd_res_cck</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cont_did.html">cont_did</a></span><span class="op">(</span></span>
<span>  yname <span class="op">=</span> <span class="st">"Y"</span>,</span>
<span>  tname <span class="op">=</span> <span class="st">"time_period"</span>,</span>
<span>  idname <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>  dname <span class="op">=</span> <span class="st">"D"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">df2</span>,</span>
<span>  gname <span class="op">=</span> <span class="st">"G"</span>,</span>
<span>  target_parameter <span class="op">=</span> <span class="st">"level"</span>,</span>
<span>  aggregation <span class="op">=</span> <span class="st">"dose"</span>,</span>
<span>  treatment_type <span class="op">=</span> <span class="st">"continuous"</span>,</span>
<span>  dose_est_method <span class="op">=</span> <span class="st">"cck"</span>,</span>
<span>  control_group <span class="op">=</span> <span class="st">"notyettreated"</span>,</span>
<span>  biters <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  cband <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cd_res_cck</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall ATT:  </span></span>
<span><span class="co">#&gt;     ATT    Std. Error     [ 95%  Conf. Int.]  </span></span>
<span><span class="co">#&gt;  0.3399         0.037     0.2673      0.4125 *</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall ACRT:  </span></span>
<span><span class="co">#&gt;    ACRT    Std. Error     [ 95%  Conf. Int.]  </span></span>
<span><span class="co">#&gt;  0.6595        0.1853     0.2964      1.0226 *</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes: `*' confidence band does not cover 0</span></span>
<span><span class="fu"><a href="reference/ggcont_did.html">ggcont_did</a></span><span class="op">(</span><span class="va">cd_res_cck</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_function</span><span class="op">(</span></span>
<span>    fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Truth"</span><span class="op">)</span>,</span>
<span>    linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Truth"</span> <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>color <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-8-1.png" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-callaway-goodman-santanna-2025" class="csl-entry">
Callaway, Brantly, Andrew Goodman-Bacon, and Pedro H. C. Sant‚ÄôAnna. 2025. ‚ÄúDifference-in-Differences with a Continuous Treatment.‚Äù
</div>
<div id="ref-chen-christensen-kankanala-2025" class="csl-entry">
Chen, Xiaohong, Timothy Christensen, and Sid Kankanala. 2025. ‚ÄúAdaptive Estimation and Uniform Confidence Bands for Nonparametric Structural Functions and Elasticities.‚Äù <em>Review of Economic Studies</em> 92 (1): 162‚Äì96.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/bcallaway11/contdid/">Browse source code</a></li>
<li><a href="https://github.com/bcallaway11/contdid/issues">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing contdid</a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Brantly Callaway, Andrew Goodman-Bacon, Pedro H. C. Sant‚ÄôAnna.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
